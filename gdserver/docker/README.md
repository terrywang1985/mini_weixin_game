# ç»Ÿä¸€åŒ– Docker éƒ¨ç½²è¯´æ˜

## ğŸ¯ ä¼˜åŒ–æ¦‚è¿°

æˆ‘ä»¬å°†åŸæ¥çš„å¤šä¸ªç‹¬ç«‹ Dockerfile ç»Ÿä¸€ä¸ºä¸€ä¸ª `Dockerfile.unified`ï¼Œé€šè¿‡å‚æ•°åŒ–å¯åŠ¨è„šæœ¬å®ç°ä¸åŒæœåŠ¡çš„å¯åŠ¨ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
docker/
â”œâ”€â”€ Dockerfile.unified     # ç»Ÿä¸€çš„ Dockerfileï¼ˆæ–°ï¼‰
â”œâ”€â”€ Dockerfile.game        # åŸæ¸¸æˆæœåŠ¡ Dockerfileï¼ˆä¿ç•™ç”¨äºå‚è€ƒï¼‰
â”œâ”€â”€ Dockerfile.battle      # åŸæˆ˜æ–—æœåŠ¡ Dockerfileï¼ˆä¿ç•™ç”¨äºå‚è€ƒï¼‰
â”œâ”€â”€ Dockerfile.login       # åŸç™»å½•æœåŠ¡ Dockerfileï¼ˆä¿ç•™ç”¨äºå‚è€ƒï¼‰
â””â”€â”€ Dockerfile.match       # åŸåŒ¹é…æœåŠ¡ Dockerfileï¼ˆä¿ç•™ç”¨äºå‚è€ƒï¼‰
```

## ğŸ”§ å·¥ä½œåŸç†

### ç»Ÿä¸€æ„å»ºè¿‡ç¨‹

1. **å¤åˆ¶å®Œæ•´æœåŠ¡å™¨ä»£ç **ï¼šå°†æ•´ä¸ª `server/` ç›®å½•å¤åˆ¶åˆ°å®¹å™¨ä¸­
2. **æ‰§è¡Œç»Ÿä¸€æ„å»º**ï¼šè¿è¡Œ `build.sh` æ„å»ºæ‰€æœ‰æœåŠ¡å™¨
3. **å‚æ•°åŒ–å¯åŠ¨**ï¼šé€šè¿‡ä¿®æ”¹åçš„ `start.sh` è„šæœ¬æ”¯æŒå•æœåŠ¡å¯åŠ¨

### å‚æ•°åŒ–å¯åŠ¨è„šæœ¬

ä¿®æ”¹åçš„ `start.sh` æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š

```bash
./start.sh login   # åªå¯åŠ¨ç™»å½•æœåŠ¡å™¨
./start.sh game    # åªå¯åŠ¨æ¸¸æˆæœåŠ¡å™¨
./start.sh battle  # åªå¯åŠ¨æˆ˜æ–—æœåŠ¡å™¨
./start.sh all     # å¯åŠ¨æ‰€æœ‰æœåŠ¡å™¨ï¼ˆé»˜è®¤ï¼‰
```

## ğŸ³ Docker Compose é…ç½®

æ¯ä¸ªæœåŠ¡ä½¿ç”¨ç›¸åŒçš„é•œåƒï¼Œä½†é€šè¿‡ä¸åŒçš„ `command` å‚æ•°å¯åŠ¨ï¼š

```yaml
# ç™»å½•æœåŠ¡
login-server:
  build:
    dockerfile: docker/Dockerfile.unified
  command: ["./start.sh", "login"]
  
# æ¸¸æˆæœåŠ¡
game-server:
  build:
    dockerfile: docker/Dockerfile.unified
  command: ["./start.sh", "game"]
  
# æˆ˜æ–—æœåŠ¡
battle-server:
  build:
    dockerfile: docker/Dockerfile.unified
  command: ["./start.sh", "battle"]
```

## âœ… ä¼˜åŠ¿

1. **ç»Ÿä¸€æ€§**ï¼šæ‰€æœ‰å®¹å™¨å†…å®¹å®Œå…¨ä¸€è‡´ï¼Œé¿å…å·®å¼‚å¯¼è‡´çš„é—®é¢˜
2. **ç®€åŒ–ç»´æŠ¤**ï¼šåªéœ€ç»´æŠ¤ä¸€ä¸ª Dockerfile
3. **çµæ´»æ€§**ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°æœåŠ¡ï¼Œåªéœ€ä¿®æ”¹å¯åŠ¨è„šæœ¬
4. **ä¸€è‡´æ€§**ï¼šæœ¬åœ°å¼€å‘å’Œå®¹å™¨éƒ¨ç½²ä½¿ç”¨ç›¸åŒçš„æ„å»ºå’Œå¯åŠ¨é€»è¾‘
5. **å‡å°‘é‡å¤**ï¼šé¿å…å¤šä¸ª Dockerfile ä¸­çš„é‡å¤ä»£ç 

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
docker-compose up -d --build
```

### åªå¯åŠ¨ç‰¹å®šæœåŠ¡

```bash
# åªå¯åŠ¨ç™»å½•æœåŠ¡
docker-compose up -d login-server

# åªå¯åŠ¨æ¸¸æˆæœåŠ¡
docker-compose up -d game-server

# åªå¯åŠ¨æˆ˜æ–—æœåŠ¡
docker-compose up -d battle-server
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f game-server

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f
```

## ğŸ” è°ƒè¯•å’Œå¼€å‘

### è¿›å…¥å®¹å™¨è°ƒè¯•

```bash
# è¿›å…¥æ¸¸æˆæœåŠ¡å™¨å®¹å™¨
docker-compose exec game-server /bin/bash

# æŸ¥çœ‹å®¹å™¨å†…çš„æ–‡ä»¶ç»“æ„
ls -la /app
```

### å•ç‹¬æµ‹è¯•æœåŠ¡

```bash
# æ„å»ºé•œåƒ
docker build -f docker/Dockerfile.unified -t jigger-unified .

# æµ‹è¯•å¯åŠ¨ç™»å½•æœåŠ¡
docker run --rm -p 8081:8081 jigger-unified ./start.sh login

# æµ‹è¯•å¯åŠ¨æ¸¸æˆæœåŠ¡
docker run --rm -p 18080:18080 -p 12345:12345 -p 50051:50051 jigger-unified ./start.sh game
```

## ğŸ“Š å¯¹æ¯”è¡¨

| é¡¹ç›® | åŸæ–¹æ¡ˆ | ç»Ÿä¸€æ–¹æ¡ˆ |
|------|--------|----------|
| Dockerfile æ•°é‡ | 4 ä¸ªç‹¬ç«‹æ–‡ä»¶ | 1 ä¸ªç»Ÿä¸€æ–‡ä»¶ |
| é•œåƒå¤§å° | å„ä¸ç›¸åŒ | å®Œå…¨ä¸€è‡´ |
| ç»´æŠ¤å¤æ‚åº¦ | é«˜ï¼ˆéœ€åŒæ­¥ä¿®æ”¹ï¼‰ | ä½ï¼ˆåªéœ€ä¿®æ”¹ä¸€å¤„ï¼‰ |
| æ„å»ºæ—¶é—´ | å„è‡ªæ„å»º | ä¸€æ¬¡æ„å»ºå…¨éƒ¨ |
| ä¸€è‡´æ€§ä¿è¯ | ä¾èµ–æ‰‹åŠ¨åŒæ­¥ | å¤©ç„¶ä¸€è‡´ |

è¿™ç§ç»Ÿä¸€åŒ–çš„æ–¹æ¡ˆå¤§å¤§ç®€åŒ–äº†éƒ¨ç½²å’Œç»´æŠ¤çš„å¤æ‚åº¦ï¼ŒåŒæ—¶ä¿è¯äº†æ‰€æœ‰æœåŠ¡çš„ä¸€è‡´æ€§ã€‚